<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="reply">
<insert id="insertReply">
insert into reply (rp_rv_idx, rp_writer, rp_content)
values (#{rp_rv_idx}, #{rp_writer}, #{rp_content})
</insert>

<update id="editReply">
update reply
set rp_content=#{rp_content}
where rp_idx=#{rp_idx}
</update>

<delete id="delete">
delete from reply where rp_idx=#{rp_idx}
</delete>

<select id="searchReviews" resultType="java.util.Map">
select @rownum:=@rownum+1 as rownum, v.* 
from v_hotel_review v, (select @rownum:=(#{start}-1)) tmp
where 
	h_idx=#{h_idx}
	and rv_content like concat('%', #{keyword}, '%')
  <choose>
	<when test="sort == 'highest'">
		order by rv_star desc, rv_idx desc
	</when>
	<when test="sort == 'lowest'">
		order by rv_star, rv_idx desc
	</when>
	<otherwise>
		order by rv_idx desc
	</otherwise>
  </choose>
ORDER BY rv_idx desc
limit #{start}, #{end};
</select>
</mapper>